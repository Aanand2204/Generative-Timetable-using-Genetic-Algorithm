<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enter Credits</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style_prior.css') }}">
</head>
<body>
    <div id="timetableContainer" style="display: none;">
        <h3>Generated Timetable</h3>
        <table id="timetable">
            <thead>
                <tr>
                    <th>Timeslot</th>
                    <th>Monday</th>
                    <th>Tuesday</th>
                    <th>Wednesday</th>
                    <th>Thursday</th>
                    <th>Friday</th>
                    <th>Saturday</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
    
    <div class="container">
        <h2>Step 2: Enter Subject Credits</h2>
        <form id="creditsForm">
            <div id="creditInputs"></div>
            <button type="submit">Generate Timetable</button>
        </form>
    </div>

    <script>
        fetch("/get_priorities")
        .then(response => response.json())
        .then(data => {
            let creditInputsDiv = document.getElementById("creditInputs");
            creditInputsDiv.innerHTML = "<h3>Assign Credits</h3>";

            data.subjects.forEach(subject => {
                let inputField = `
                    <label>${subject}:</label>
                    <input type="number" name="${subject}-credits" class="credit-input" min="1" required>
                    <br>`;
                creditInputsDiv.innerHTML += inputField;
            });
        });

        document.getElementById("creditsForm").addEventListener("submit", function(event) {
            event.preventDefault();
            let formData = new FormData(this);
            let credits = {};
            document.querySelectorAll(".credit-input").forEach(input => {
                let subjectName = input.name.replace("-credits", "").trim();
                credits[subjectName] = parseInt(input.value, 10);
            });

            fetch("/generate", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ credits: credits })
            })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(err => { throw new Error(err.error || "Unknown error occurred"); });
                }
                return response.json();
            })
            .then(data => {
                alert("✅ Timetable generated successfully!");

                let tableBody = document.querySelector("#timetable tbody");

                if (!tableBody) {  // Ensure the table exists before updating
                    alert("⚠️ Error: Timetable table not found in the document.");
                    return;
                }

                tableBody.innerHTML = "";  // Clear old data

                data.timetable.forEach(row => {
                    let tr = document.createElement("tr");

                    let timeslotTd = document.createElement("td");
                    timeslotTd.textContent = row["Timeslot"];
                    tr.appendChild(timeslotTd);

                    ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"].forEach(day => {
                        let td = document.createElement("td");
                        td.textContent = row[day] || "-";
                        tr.appendChild(td);
                    });

                    tableBody.appendChild(tr);
                });

                document.getElementById("timetableContainer").style.display = "block";
            })
            .catch(error => alert(`⚠️ Error: ${error.message}`));


        });
    </script>
</body>
</html>
